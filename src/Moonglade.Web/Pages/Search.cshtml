@page "/search"
@using Moonglade.Core.PostFeature
@using Microsoft.AspNetCore.Mvc.TagHelpers
@inject IMediator Mediator

@section meta
{
    <meta name="robots" content="noindex, nofollow" />
}
@{
    var term = Request.Query["term"];
    if (string.IsNullOrWhiteSpace(term)) RedirectToPage("Index");
    
    var posts = await Mediator.Send(new SearchPostQuery(term));

    ViewBag.TitlePrefix = term.ToString();
    HttpContext.Response.Headers.Add("X-Robots-Tag", "noindex, nofollow");
}

<h3>
    @SharedLocalizer["Search Result"]
</h3>
<hr />
@if (!posts.Any())
{
    <div class="alert alert-info">
        @SharedLocalizer["No Matching Result"]
    </div>
}
else
{
    foreach (var item in posts.OrderByDescending(s => s.PubDateUtc))
    {
        <partial name="_PostListEntry" model="item" />
        <div class="mb-4 d-none d-md-block"></div>
        <hr class="d-none d-md-block" />
    }
}

<partial name="_LightSwitch" />